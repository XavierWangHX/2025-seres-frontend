<!DOCTYPE html>
<html lang="en">

<head>
    <title>Seres Researcher</title>
    <meta name="description" content="A research assistant powered by Qwen-Max">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="./static/seres.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="/site/styles.css" />

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify/dist/purify.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/styles/github.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.7.0/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>
    

    
     
<body>
    <!-- 隐藏式左侧导航栏 -->
    <div class="nav-panel-container">
        <button id="navPanelToggle" class="nav-toggle-btn">
            <i class="fas fa-bars"></i>
        </button>
        
        <div class="nav-panel" id="navPanel">
            <div class="nav-panel-header">
                <h3>快速选择舆情方向</h3>
            </div>
            <div class="nav-panel-content">
                <div class="selection-hint" id="selectionHint">请选择查看舆情的车型</div>
                <div class="vehicle-grid">
                    <div class="vehicle-item" data-vehicle="问界M7">问界M7</div>
                    <div class="vehicle-item" data-vehicle="问界M9">问界M9</div>
                    <div class="vehicle-item" data-vehicle="问界M5">问界M5</div>
                    <div class="vehicle-item" data-vehicle="小米SU7">小米SU7</div>
                    <div class="vehicle-item" data-vehicle="理想L9">理想L9</div>
                    <div class="vehicle-item" data-vehicle="蔚来ET7">蔚来ET7</div>
                    <div class="vehicle-item" data-vehicle="特斯拉Model Y">Model Y</div>
                    <div class="vehicle-item" data-vehicle="比亚迪汉">比亚迪汉</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Buttons (moved from top bar) -->
    <div class="nav-buttons">
        <div id="historyPanelOpenBtn" class="top-history-button">
            <i class="fas fa-history"></i> History
        </div>
        <div id="websocketPanelOpenBtn" class="top-websocket-button">
            <i class="fas fa-network-wired"></i> Status
        </div>
    </div>

    <!-- WebSocket Status Panel -->
    <div class="websocket-panel" id="websocketPanel">
        <div class="websocket-panel-header">
            <h3><i class="fas fa-plug"></i> Connection Status</h3>
            <div class="websocket-panel-actions">
                <button id="websocketPanelToggle" class="websocket-action-btn" title="Close panel">
                    <i class="fas fa-chevron-left"></i>
                </button>
            </div>
        </div>
        <div class="websocket-status">
            <div class="status-item">
                <span class="status-label">Connection:</span>
                <span class="status-value" id="connectionStatus">Disconnected</span>
                <span class="status-indicator" id="connectionIndicator"></span>
            </div>
            <div class="status-item">
                <span class="status-label">Research:</span>
                <span class="status-value" id="researchStatus">Inactive</span>
            </div>
            <div class="status-item">
                <span class="status-label">Connected for:</span>
                <span class="status-value" id="connectionDuration">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">Last activity:</span>
                <span class="status-value" id="lastActivity">-</span>
            </div>
            <div class="status-item">
                <span class="status-label">ReadyState:</span>
                <span class="status-value" id="readyState">-</span>
            </div>
            <div class="status-divider"></div>
            <div class="status-item">
                <span class="status-label">Connection attempts:</span>
                <span class="status-value" id="connectionAttempts">0</span>
            </div>
            <div class="status-item">
                <span class="status-label">Messages received:</span>
                <span class="status-value" id="messagesReceived">0</span>
            </div>
            <div class="status-divider"></div>
            <div class="status-item">
                <span class="status-label">Current task:</span>
                <span class="status-value" id="currentTask">-</span>
            </div>
        </div>
    </div>
    <section class="landing">
        <div class="max-w-5xl mx-auto text-center">
            <h1 class="text-4xl font-extrabold mx-auto lg:text-7xl">
                赛力斯 <br>
                <span
                    style="background-image:linear-gradient(to right, #9867F0, #ED4E50); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">AI驱动情报枢纽
                    </span>
            </h1>
            <p class="max-w-6xl mx-auto text-gray-600 mt-8" style="font-size:20px">
                欢迎<b>使用赛力斯舆情助手</b>, 你的AI舆情研究最佳助手. <br>
                点击下方开始按钮即可以选择感兴趣话题进行助手研究
            </p>
            <a href="#form" class="btn btn-primary">开始研究</a>
        </div>
    </section>
    
    
    <div class="quick-access-grid">
        <div class="quick-access-card" data-target="index.html">
            <i class="fas fa-search"></i>
            <h3>报告研究助手</h3>
            <p>自动获取数据高效分析研究</p>
        </div>
        
        <div class="quick-access-card" data-target="data.html">
            <i class="fas fa-chart-line"></i>
            <h3>数据研究助手</h3>
            <p>了解数据分析和调研领域的最新趋势</p>
        </div>
        
        <div class="quick-access-card" data-target="comment.html">
            <i class="fas fa-comments"></i>
            <h3>舆情关注助手</h3>
            <p>实时监测和分析行业舆情动态</p>
        </div>
        
        <div class="quick-access-card" data-target="none.html">
            <i class="fas fa-file-invoice-dollar"></i>
            <h3>财报分析助手</h3>
            <p>深度解析企业财务报告数据</p>
        </div>
        
        <div class="quick-access-card" data-target="data.html">
            <i class="fas fa-chess"></i>
            <h3>竞品监测助手</h3>
            <p>实时跟踪竞争对手动态</p>
        </div>
        
        <div class="quick-access-card" data-target="a.html">
            <i class="fas fa-newspaper"></i>
            <h3>AI读报助手</h3>
            <p>智能摘要文档内容</p>
        </div>
    </div>
    <!-- Scroll to bottom button -->
    <div class="scroll-to-bottom" id="scrollToBottomBtn">
        <i class="fas fa-arrow-down"></i>
    </div>

    

    <main class="container main-content" id="form">
        <!-- 添加快捷车型方块 -->
        <div class="quick-vehicles">
            <div class="vehicle-card1" data-vehicle="问界M5">
                <i class="fas fa-car"></i>
                <span>问界M5</span>
            </div>
            <div class="vehicle-card1" data-vehicle="问界M7">
                <i class="fas fa-car"></i>
                <span>问界M7</span>
            </div>
            <div class="vehicle-card1" data-vehicle="问界M9">
                <i class="fas fa-car"></i>
                <span>问界M9</span>
            </div>
            <div class="vehicle-card1" data-vehicle="问界M8">
                <i class="fas fa-car"></i>
                <span>问界M8</span>
            </div>
            <div class="vehicle-card" data-vehicle="乐道L90">
                <i class="fas fa-car"></i>
                <span>乐道L90</span>
            </div>
            <div class="vehicle-card" data-vehicle="宝马iX3">
                <i class="fas fa-car"></i>
                <span>宝马iX3</span>
            </div>
            <div class="vehicle-card" data-vehicle="奥迪Q4 e-tron">
                <i class="fas fa-car"></i>
                <span>奥迪Q4 e-tron</span>
            </div>
            
            <div class="vehicle-card" data-vehicle="蔚来EC7">
                <i class="fas fa-car"></i>
                <span>蔚来EC7</span>
            </div>
            
            <div class="vehicle-card" data-vehicle="蔚来Es8">
                <i class="fas fa-car"></i>
                <span>蔚来Es8</span>
            </div>
            <div class="vehicle-card" data-vehicle="红旗HQ9 PHEV">
                <i class="fas fa-car"></i>
                <span>红旗HQ9 PHEV</span>
            </div>
        
            
            <div class="vehicle-card" data-vehicle="蔚来Es7">
                <i class="fas fa-car"></i>
                <span>蔚来Es7</span>
            </div>
            
            <div class="vehicle-card" data-vehicle="小米SU7">
                <i class="fas fa-car"></i>
                <span>小米SU7</span>
            </div>
            <div class="vehicle-card" data-vehicle="理想L9">
                <i class="fas fa-car"></i>
                <span>理想L9</span>
            </div>
        </div>

        <div class="agent-item"><img src="./static/seres.png" class="avatar" alt="Auto Agent"></div>
        <form method="POST" class="mt-3" id="researchForm">
            <div class="form-group">
                <label for="task" class="agent-question">你想研究的车型是?</label>
                <textarea id="task" name="task" class="form-control highlight-connection" placeholder="Enter any topic, question, or idea..." required autocomplete="on"></textarea>
                <input type="radio" name="agent" id="autoAgent" value="Auto Agent" checked hidden>
            </div>
            <div class="form-group">
                <div class="row"></div>
                <button type="button" id="btnShowAuto" class="btn btn-secondary mt-3 btn-show">Auto Agent</button>
            </div>
            <div class="form-group">
                <label for="report_type" class="agent-question">竞品分析</label>
                <select name="report_type" id="report_type" class="form-control highlight-connection" required>
                    <option value="research_report">摘要 - 简短快速 (~2分钟)</option>
                    <option value="detailed_report">详细 - 深入且较长 (~5分钟)</option>
                    <option value="deep">深度研究</option>
                    <option value="custom_report1">竞品车型分析</option>
                    <option value="custom_report2">舆情分析</option>
                </select>
            </div>
            <div class="form-group">
                <label for="tone" class="agent-question">你需要哪种语气报告?</label>
                <select name="tone" id="tone" class="form-control highlight-connection" required>
                    <option value="Objective">客观语气</option>
                    <option value="Formal">文本格式 </option>
                </select>
            </div>
            <div class="form-group">
                <label for="report_source" class="agent-question">数据来源?</label>
                <p class="text-left mt-0 pt-0" style="font-size: 0.7rem;">你可以选择任何结构风格.</p>
                <select name="report_source" id="report_source" class="form-control highlight-connection" required>
                    <option value="web">网络爬取</option>
                    <option value="local">本地</option>
                    <option value="hybrid">混合</option>
                </select>
            </div>
            <div class="form-group">
                <label for="queryDomains" class="form-label">可选网站</label>
                <input type="text" class="form-control highlight-connection" id="queryDomains" name="query_domains" placeholder="Enter domains separated by commas" autocomplete="on">
                <small class="text-muted">比如： techcrunch.com, forbes.com</small>
            </div>
            <input type="submit" value="Begin Research" class="btn btn-primary button-padding" id="submitButton">
        </form>

        <!-- Add JSON button above Research Progress section -->
        <div class="margin-div" id="jsonButtonContainer" style="display: none; text-align: right; margin-bottom: 10px;">
            <a id="downloadLinkJsonTop" href="#" class="report-action-btn disabled" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-file-code"></i> JSON
            </a>
        </div>

        <div class="margin-div research-output-container">
            <!-- Move spinner to the left side of the text -->
            <h2><div id="modernSpinner" class="modern-spinner"></div> 研究进行。。。 <button id="expandOutputBtn" class="expand-button" title="Expand"><i class="fas fa-expand-alt"></i></button></h2>
            <p class="mt-2 text-left" style="font-size: 0.8rem;">
                实时研究内容.</p>
            <div id="output" class="research-output-content"></div>
        </div>
        <div class="images_div">
            <div id="selectedImagesContainer" style="display: none;"></div>
        </div>
        <div class="margin-div report-container">
            <h2>Research Report
                <button id="copyToClipboardTop" class="icon-button" title="Copy" style="display: none;">
                    <i class="fas fa-copy"></i>
                </button>
                <button id="expandReportBtn" class="expand-button" title="Expand">
                    <i class="fas fa-expand-alt"></i>
                </button>
            </h2>
            <!-- Add download buttons above the report container -->
            <div class="report-actions" style="display: none;">
                <a id="downloadLinkTop" href="#" class="report-action-btn disabled" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-file-pdf"></i> PDF
                </a>
                <a id="downloadLinkWordTop" href="#" class="report-action-btn disabled" target="_blank" rel="noopener noreferrer>
                    <i class="fas fa-file-word"></i> Word
                </a>
                <a id="downloadLinkMdTop" href="#" class="report-action-btn disabled" target="_blank" rel="noopener noreferrer">
                    <i class="fas fa-file-lines"></i> Markdown
                </a>
            </div>
            <div id="reportContainer"></div>
            <div id="reportActions" style="display: none;">
                <div class="alert alert-info" role="alert" id="status"></div>
            </div>
        </div>

        <!-- Chat Container -->
        <div class="margin-div chat-container" id="chatContainer" style="display: none;">
            <h2><i class="fas fa-comments"></i> AI对话模块 <button id="expandChatBtn" class="expand-button" title="Expand"><i class="fas fa-expand-alt"></i></button></h2>
            <p class="text-muted">你可以询问上述任何细节问题</p>
            <div id="chatMessages" class="chat-messages"></div>
            <div class="chat-input-container">
                <textarea id="chatInput" class="form-control chat-input" placeholder="Ask a question about this research..." rows="2"></textarea>
                <button id="voiceInputBtn" class="btn btn-secondary" title="Use voice input">
                    <i class="fas fa-microphone"></i>
                </button>
                <button id="sendChatBtn" class="btn btn-primary">
                    <i class="fas fa-paper-plane"></i> Send
                </button>
            </div>
        </div>
    </main>

    <!-- Conversation History Panel -->
    <div class="history-panel" id="historyPanel">
        <div class="history-panel-header">
            <h3><i class="fas fa-history"></i> Research History</h3>
            <div class="history-panel-actions">
                <button id="historyPanelToggle" class="history-action-btn" title="Close panel">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
        <div class="history-panel-search">
            <input type="text" id="historySearch" placeholder="Search research history...">
            <button id="historySearchBtn" class="history-action-btn" title="Search">
                <i class="fas fa-search"></i>
            </button>
        </div>
        <div class="history-panel-filters">
            <select id="historySortOrder">
                <option value="newest">Newest First</option>
                <option value="oldest">Oldest First</option>
            </select>
            <!-- JS will add Import/Export/Debug buttons here -->
            <button id="historyClearBtn" class="history-action-btn" title="Clear all history">
                <i class="fas fa-trash-alt"></i>
            </button>
        </div>
        <div class="history-panel-entries" id="historyEntries">
            <!-- Entries will be populated dynamically -->
        </div>
    </div>
    
    <!-- Sticky Downloads Bar -->
    <div class="sticky-downloads-bar" id="stickyDownloadsBar" style="display: none;"> <!-- Initially hidden -->
        <div class="download-buttons-container">
            <a id="copyToClipboard" class="download-option-btn disabled">
                <i class="fas fa-copy"></i> Copy (Markdown)
            </a>
            <a id="downloadLinkMd" href="#" class="download-option-btn disabled" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-file-lines"></i> Markdown
            </a>
            <a id="downloadLink" href="#" class="download-option-btn disabled" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-file-pdf"></i> PDF
            </a>
            <a id="downloadLinkWord" href="#" class="download-option-btn disabled" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-file-word"></i> Word
            </a>
            <a id="downloadLinkJson" href="#" class="download-option-btn disabled" target="_blank" rel="noopener noreferrer">
                <i class="fas fa-file-code"></i> Log (JSON)
            </a>
        </div>
    </div>

    <footer>
        <p>Seres Researcher &copy; 2025</p>
    </footer>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/showdown/1.9.1/showdown.min.js"></script>
    <script src="/site/scripts.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Auto-resize textarea as content grows
            const taskTextarea = document.getElementById('task');
            if (taskTextarea) {
                // Set initial height
                taskTextarea.setAttribute('style', 'height: 38px; overflow-y: hidden;');

                // Function to resize textarea based on content
                const resizeTextarea = () => {
                    taskTextarea.style.height = 'auto';
                    taskTextarea.style.height = taskTextarea.scrollHeight + 'px';
                };

                // Add event listeners for input and focus
                taskTextarea.addEventListener('input', resizeTextarea);
                taskTextarea.addEventListener('focus', resizeTextarea);
            }

            // Scroll to bottom button functionality
            const scrollToBottomBtn = document.getElementById('scrollToBottomBtn');
            if (scrollToBottomBtn) {
                scrollToBottomBtn.addEventListener('click', function() {
                    window.scrollTo({
                        top: document.body.scrollHeight,
                        behavior: 'smooth'
                    });
                });
            }

            // 左侧导航面板交互
            const navToggleBtn = document.getElementById('navPanelToggle');
            const navPanel = document.getElementById('navPanel');
            const mainContent = document.querySelector('.main-content');
            
            if (navToggleBtn && navPanel && mainContent) {
                navToggleBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    navPanel.classList.toggle('active');
                    mainContent.classList.toggle('with-left-panel');
                    
                    if (navPanel.classList.contains('active')) {
                        navToggleBtn.style.left = '250px';
                    } else {
                        navToggleBtn.style.left = '0';
                    }
                });

                // 点击外部关闭面板
                document.addEventListener('click', function(e) {
                    if (!navPanel.contains(e.target) && e.target !== navToggleBtn && navPanel.classList.contains('active')) {
                        navPanel.classList.remove('active');
                        mainContent.classList.remove('with-left-panel');
                        navToggleBtn.style.left = '0';
                    }
                });
            }

            // WebSocket面板交互
            const wsToggleBtn = document.getElementById('websocketPanelToggle');
            const wsPanel = document.getElementById('websocketPanel');
            
            if (wsToggleBtn && wsPanel && mainContent) {
                wsToggleBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    wsPanel.classList.toggle('active');
                    mainContent.classList.toggle('with-right-panel');
                });

                // 点击外部关闭面板
                document.addEventListener('click', function(e) {
                    if (!wsPanel.contains(e.target) && e.target !== document.getElementById('websocketPanelOpenBtn') && wsPanel.classList.contains('active')) {
                        wsPanel.classList.remove('active');
                        mainContent.classList.remove('with-right-panel');
                    }
                });
            }

            // 打开WebSocket面板按钮
            const wsOpenBtn = document.getElementById('websocketPanelOpenBtn');
            if (wsOpenBtn && wsPanel && mainContent) {
                wsOpenBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    wsPanel.classList.add('active');
                    mainContent.classList.add('with-right-panel');
                });
            }

            // 车型选择功能
            let selectedVehicles = [];
            const selectionHint = document.getElementById('selectionHint');
            const taskInput = document.getElementById('task');

            // 更新提示信息
            function updateSelectionHint() {
                if (selectionHint) {
                    if (selectedVehicles.length === 0) {
                        selectionHint.textContent = '请选择要对比的车型';
                    } else if (selectedVehicles.length === 1) {
                        selectionHint.textContent = `已选择: ${selectedVehicles[0]}，请再选择一个竞品车型`;
                    } else {
                        selectionHint.textContent = `将对比: ${selectedVehicles.join(' vs ')}`;
                        // 自动填充到输入框
                        if (taskInput) {
                            taskInput.value = `请对比分析${selectedVehicles[0]}和${selectedVehicles[1]}的竞品参数，包括价格、尺寸、动力系统等`;
                        }
                    }
                }
            }

            // 重置选择状态
            function resetSelection() {
                selectedVehicles = [];
                document.querySelectorAll('.vehicle-card1.selected, .vehicle-card.selected').forEach(el => {
                    el.classList.remove('selected');
                });
                updateSelectionHint();
            }

            // 设置车型选择事件
            function setupVehicleSelection() {
                document.querySelectorAll('.vehicle-card1, .vehicle-card').forEach(item => {
                    item.addEventListener('click', function(e) {
                        e.stopPropagation();
                        const vehicle = this.getAttribute('data-vehicle');
                        
                        // 如果已经选中了这个车型，则取消选择
                        const index = selectedVehicles.indexOf(vehicle);
                        if (index > -1) {
                            selectedVehicles.splice(index, 1);
                            this.classList.remove('selected');
                        } else {
                            // 最多选择两个车型
                            if (selectedVehicles.length < 2) {
                                selectedVehicles.push(vehicle);
                                this.classList.add('selected');
                            } else {
                                // 如果已经选择了两个，先取消第一个选择
                                const firstSelected = document.querySelector(`[data-vehicle="${selectedVehicles[0]}"]`);
                                if (firstSelected) firstSelected.classList.remove('selected');
                                selectedVehicles.shift();
                                selectedVehicles.push(vehicle);
                                this.classList.add('selected');
                            }
                        }
                        
                        updateSelectionHint();
                        
                        // 如果已经选择了两个车型，自动滚动到表单
                        if (selectedVehicles.length === 2 && taskInput) {
                            setTimeout(() => {
                                taskInput.scrollIntoView({ behavior: 'smooth' });
                            }, 300);
                        }
                    });
                });
            }

            // 设置快速访问卡片点击事件
            function setupQuickAccessCards() {
                document.querySelectorAll('.quick-access-card').forEach(card => {
                    card.addEventListener('click', function() {
                        // 添加点击效果
                        this.classList.add('clicked');
                        setTimeout(() => {
                            this.classList.remove('clicked');
                        }, 200);
                        
                        // 获取目标URL
                        const target = this.getAttribute('data-target');
                        if (target && target !== 'none.html') {
                            // 如果有目标URL且不是none.html，则跳转到该URL
                            window.location.href = target;
                        } else {
                            // 否则可以添加其他处理逻辑，比如显示提示
                            alert('此功能正在开发中');
                        }
                    });
                });
            }

            // 初始化车型选择功能
            setupVehicleSelection();
            
            // 初始化快速访问卡片功能
            setupQuickAccessCards();

            // 表单提交处理
            const researchForm = document.getElementById('researchForm');
            if (researchForm) {
                researchForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    // 这里可以添加表单提交逻辑
                    console.log('表单提交:', {
                        task: taskInput.value,
                        report_type: document.getElementById('custom_report').value,
                        tone: document.getElementById('tone').value,
                        report_source: document.getElementById('report_source').value,
                        query_domains: document.getElementById('queryDomains').value
                    });
                    
                    // 显示加载状态
                    document.getElementById('output').textContent = '正在进行研究...';
                    
                    
                });
            }

            // 确保所有元素加载完成后再执行
            setTimeout(() => {
                window.dispatchEvent(new Event('scroll'));
            }, 100);
        });
    </script>
</body>
</html>